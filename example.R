### white 45 40 11 4
### African 51 26 19 4

x <- c(0.45, 0.4, 0.11, 0.04)
y <- c(0.51, 0.26, 0.19, 0.04)

r <- c(0.05, 0.25, 0.45, 0.65, 0.9)
ga <- seq(from = 0.01, to = 0.4, by = 0.01)
p <- c(0.9, 0.1)

s <- matrix(NA, nrow = 5, ncol = 40)
tir <- matrix(NA, nrow = 2, ncol = 5)
sir <- matrix(NA, nrow = 2, ncol = 5)
uir <- array(NA, dim = c(5, 40))
R1 <- rep(NA, 40)
R2 <- rep(NA, 40)

for (j in c(1: 5)){
  tir[1, j] <- p[1] * (r[j] * (x[1]+x[4]-x[1]*x[4]+x[2]^2+x[3]^2) + 2*x[2]*x[3])
  tir[2, j] <- p[2] * (r[j] * (y[1]+y[4]-y[1]*y[4]+y[2]^2+y[3]^2) + 2*y[2]*y[3])
  sir[1, j] <- tir[1, j] + p[1] * (x[1]*(1-x[1])+x[2]*x[4]+x[3]*x[4])
  sir[2, j] <- tir[2, j] + p[2] * (y[1]*(1-y[1])+y[2]*y[4]+y[3]*y[4])
  for (k in c(1: 40)){
    uir[j, k] <- tir[1, j] + tir[2, j] + p[1] * ga[k] * (x[3]*x[4]+x[1]*x[4]+x[2]*x[4]+x[1]*x[2]+x[1]*x[4]+x[1]*x[3]) +
      p[2] * ga[k] * (y[3]*y[4]+y[1]*y[4]+y[2]*y[4]+y[1]*y[2]+y[1]*y[4]+y[1]*y[3])
  }
}

for (k in c(1: 40)){
  R1[k] <- min(p[1] * ga[k] * x[3]*x[4] + p[2] * ga[k] * y[3]*y[4], 
               2*p[1]*x[3]*x[4]-(p[1] * ga[k] * x[3]*x[4] + p[2] * ga[k] * y[3]*y[4])) +
    min(p[1] * ga[k] * (x[1]+x[2])*x[4] + p[2] * ga[k] * (y[1]+y[2])*y[4], 
        2*p[1]*x[2]*x[4]-(p[1] * ga[k] * (x[1]+x[2])*x[4] + p[2] * ga[k] * (y[1]+y[2])*y[4])) +
    min(p[1] * ga[k] * (x[2]+x[4])*x[1] + p[2] * ga[k] * (y[2]+y[4])*y[1], 
        2*p[1]*x[1]*x[2]-(p[1] * ga[k] * (x[2]+x[4])*x[1] + p[2] * ga[k] * (y[2]+y[4])*y[1])) +
    min(p[1] * ga[k] * x[1]*x[3] + p[2] * ga[k] * y[1]*y[3], 
        2*p[1]*x[1]*x[3]-(p[1] * ga[k] * x[1]*x[3] + p[2] * ga[k] * y[1]*y[3]))
  
  R2[k] <- min(p[1] * ga[k] * x[3]*x[4] + p[2] * ga[k] * y[3]*y[4], 
               2*p[1]*y[3]*y[4]-(p[1] * ga[k] * x[3]*x[4] + p[2] * ga[k] * y[3]*y[4])) +
    min(p[1] * ga[k] * (x[1]+x[2])*x[4] + p[2] * ga[k] * (y[1]+y[2])*y[4], 
        2*p[1]*y[2]*y[4]-(p[1] * ga[k] * (x[1]+x[2])*x[4] + p[2] * ga[k] * (y[1]+y[2])*y[4])) +
    min(p[1] * ga[k] * (x[2]+x[4])*x[1] + p[2] * ga[k] * (y[2]+y[4])*y[1], 
        2*p[1]*y[1]*y[2]-(p[1] * ga[k] * (x[2]+x[4])*x[1] + p[2] * ga[k] * (y[2]+y[4])*y[1])) +
    min(p[1] * ga[k] * x[1]*x[3] + p[2] * ga[k] * y[1]*y[3], 
        2*p[1]*y[1]*y[3]-(p[1] * ga[k] * x[1]*x[3] + p[2] * ga[k] * y[1]*y[3]))
    
}

for (j in c(1: 5))
  for (k in c(1: 40)){
    s[j, k] <- max(0, (sir[1,j]*tir[2,j]-sir[2,j]*tir[1,j]-sir[2,j]*R1[k])/sir[1,j]/uir[j,k], 
                   (sir[2,j]*tir[1,j]-sir[1,j]*tir[2,j]-sir[1,j]*R2[k])/sir[2,j]/uir[j,k])
  }

